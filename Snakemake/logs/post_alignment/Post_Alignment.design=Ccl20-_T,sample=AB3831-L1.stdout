###################################- COMMANDLINE -############################
samtools/1.9
bedtools/2.27.1
deeptools/3.1.3
fastqc/0.11.8
qualimap/2.2.1
ucsc/373
#
Description:
Filtering bam file, correctGC Bias, drop short alignment
#
INPUT1: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/alignment/AB3831-L1.bam
INPUT2: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/alignment/AB3831-L1.bam.bai
#
OUTPUT1: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam
OUTPUT2: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam.bai
OUTPUT3: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz
OUTPUT4: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.tbi
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
samtools view --threads 30 -h -F 1804 -f 2 -q 30 /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/alignment/AB3831-L1.bam | awk 'BEGIN{OFS=FS}{if ( $3 != "chrUn" && $3 != "chrEBV" && $3 !~ /chrUn/ && $3 !~ /random/ ) print $0}' | samtools view --threads 30 -Shb - > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.mapped.dupfilt.chrfilt.bam
#
bedtools intersect -v -abam /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.mapped.dupfilt.chrfilt.bam -b <(zcat -f ./Script/mm10.blacklist.bed.gz ) > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.mapped.dupfilt.chrfilt.blkfilt.bam
#
samtools sort --threads 30 -O bam /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.mapped.dupfilt.chrfilt.blkfilt.bam -o /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam
#
samtools index -@ 30 -b /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam
#
rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.mapped.dupfilt.chrfilt.bam /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.mapped.dupfilt.chrfilt.blkfilt.bam
#
bedtools bamtobed -i /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.tmp
#
LC_COLLATE=C sort -k1,1 -k2,2n /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.tmp > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.sorted
#
bgzip -c /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.sorted > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz
#
bedToBigBed /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.sorted /fdb/atac_dnase_pipelines/mm10/mm10.chrom.sizes /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bb
#
tabix -f -p bed /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz
#
rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.tmp /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bed.gz.sorted
#
samtools flagstat --threads 30 /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment/AB3831-L1.processed.samtools.txt
#
bamCoverage --bam /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam --outFileName /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bigwig --binSize 5 --normalizeUsing RPGC --extendReads 150 --outFileFormat bigwig --numberOfProcessors 30 --effectiveGenomeSize 2150570000
#
fastqc -o /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment -f bam --threads 30 /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam
#
qualimap bamqc -bam /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam -nt 30 --genome-gc-distr MOUSE - mm10 -hm 3 -nr 100 -nw 400 -outformat HTML --skip-dup-mode 1 --java-mem-size=10G -outdir /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment/AB3831-L1_processed_qualimap
#
python ./Python_Script/bamQC.py --infile /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam --outfile /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment/AB3831-L1_PBC.txt --cores 30
#
Rscript ./R_Script/run_spp_nodups.R -c=/data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam -odir=/data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment/ -savp > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment/AB3831-L1_processed_spp.txt
#
EXECUTING....
#
Analysis complete for AB3831-L1.processed.bam
Java memory size is set to 10G
Launching application...

QualiMap v.2.2.1
Built on 2016-10-03 18:14

Selected tool: bamqc
Available memory (Mb): 37
Max memory (Mb): 10737
Starting bam qc....
Loading sam header...
Loading locator...
Loading reference...
Number of windows: 400, effective number of windows: 421
Chunk of reads size: 100
Number of threads: 30
Processed 50 out of 421 windows...
Processed 100 out of 421 windows...
Processed 150 out of 421 windows...
Processed 200 out of 421 windows...
Processed 250 out of 421 windows...
Processed 300 out of 421 windows...
Processed 350 out of 421 windows...
Processed 400 out of 421 windows...
Total processed windows:421
Number of reads: 46610738
Number of valid reads: 46610738
Number of correct strand reads:0

Inside of regions...
Num mapped reads: 46610738
Num mapped first of pair: 23305376
Num mapped second of pair: 23305362
Num singletons: 0
Time taken to analyze reads: 159
Computing descriptors...
numberOfMappedBases: 3343461452
referenceSize: 2725537669
numberOfSequencedBases: 3343255511
numberOfAs: 901285156
Computing per chromosome statistics...
Computing histograms...
Overall analysis time: 169
end of bam qc
Computing report...
Writing HTML report...
HTML report created successfully

Finished
Configured logger 'root' using pararead v0.5.0
Registering input file: '/data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/post_alignment/AB3831-L1.processed.bam'
Temporary files will be stored in: '/data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment/tmp_AB3831-L1.processed_W4aVJm'
Processing with 30 cores...
[Name: chrY; Size: 91744698]
[Name: chrX; Size: 171031299]
[Name: chr13; Size: 120421639]
[Name: chr12; Size: 120129022]
[Name: chr11; Size: 122082543]
[Name: chr10; Size: 130694993]
[Name: chr17; Size: 94987271]
[Name: chr16; Size: 98207768]
[Name: chr15; Size: 104043685]
[Name: chr14; Size: 124902244]
[Name: chr19; Size: 61431566]
[Name: chr18; Size: 90702639]
[Name: chrM; Size: 16299]
[Name: chr7; Size: 145441459]
[Name: chr6; Size: 149736546]
[Name: chr5; Size: 151834684]
[Name: chr4; Size: 156508116]
[Name: chr3; Size: 160039680]
[Name: chr2; Size: 182113224]
[Name: chr1; Size: 195471971]
[Name: chr9; Size: 124595110]
[Name: chr8; Size: 129401213]
Discarding 0 chunk(s) of reads: []
Keeping 22 chunk(s) of reads: ['chrY', 'chrX', 'chr13', 'chr12', 'chr11', 'chr10', 'chr17', 'chr16', 'chr15', 'chr14', 'chr19', 'chr18', 'chrM', 'chr7', 'chr6', 'chr5', 'chr4', 'chr3', 'chr2', 'chr1', 'chr9', 'chr8']
Reduce step (merge files)...
Merging 22 files into output file: '/data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20-_T/report/post_alignment/AB3831-L1_processed_PBC.txt'
#
DONE!!!!
#
ELAPSED TIME: 5271 seconds
------------------------------------------------------------------------------
