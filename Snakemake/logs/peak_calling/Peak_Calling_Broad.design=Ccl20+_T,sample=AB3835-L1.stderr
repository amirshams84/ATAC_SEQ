Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 30
Rules claiming more threads will be scaled down.
Unlimited resources: mem_mb
Job counts:
	count	jobs
	1	Peak_Calling_Broad
	1

[Fri May 24 18:04:06 2019]
Job 0: Peak_Calling_Broad: Ccl20+_T|AB3835-L1

[-] Unloading samtools 1.9  ... 
[+] Loading samtools 1.9  ... 
[+] Loading macs  2.1.2 
[+] Loading bedtools  2.27.1 
[+] Loading deeptools  3.1.3 
[+] Loading ucsc 373 on cn1985 
###################################- COMMANDLINE -############################
module load samtools/1.9 || exit 1
module load macs/2.1.2 || exit 1
module load bedtools/2.27.1 || exit 1
module load deeptools/3.1.3 || exit 1
module load ucsc/373 || exit 1
#
Description:
Peak Calling Broad
#
INPUT1: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/post_alignment/AB3835-L1.processed.bam
INPUT2: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/post_alignment/AB3835-L1.processed.bam.bai
INPUT3: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/post_alignment/AB3835-L1.processed.bed.gz
INPUT4: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/post_alignment/AB3835-L1.processed.bed.gz.tbi
#
OUTPUT1: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz
OUTPUT2: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.tbi
OUTPUT3: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bb
OUTPUT4: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg
OUTPUT5: /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bigwig
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
macs2 callpeak --treatment /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/post_alignment/AB3835-L1.processed.bed.gz --name AB3835-L1.macs2_broad --format BED --gsize mm --broad --broad-cutoff 5.00e-02 --keep-dup all -q 5.00e-02 -B --SPMR --nomodel --shift -75 --extsize 300 --verbose 3 --outdir /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak
#
LC_COLLATE=C sort -k1,1 -k2,2n /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_peaks.broadPeak > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.sorted
#
bgzip -c /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.sorted > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz
#
tabix -f -p bed /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz
#
awk 'BEGIN{OFS="\t"}{if ($5>1000) $5=1000; print $0}' /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.sorted > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.tmp
#
bedToBigBed -as=./Script/bigBroadPeak.as -type=bed6+3 /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.tmp /fdb/atac_dnase_pipelines/mm10/mm10.chrom.sizes /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bb
#
macs2 bdgcmp -t /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_treat_pileup.bdg -c /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_control_lambda.bdg --o-prefix AB3835-L1.macs2_broad --outdir /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak --method FE --pseudocount 0.00001
#
slopBed -i /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_FE.bdg -g /fdb/atac_dnase_pipelines/mm10/mm10.chrom.sizes -b 0 | bedClip stdin /fdb/atac_dnase_pipelines/mm10/mm10.chrom.sizes /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg.tmp
#
LC_COLLATE=C sort -k1,1 -k2,2n /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg.tmp > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg
#
cut -f1,2,3 /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg | sort | uniq -d > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate.txt
#
cut -f1,2 /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg | sort | uniq -d >> /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate.txt
#
cut -f1,3 /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg | sort | uniq -d | sed 's/\t/\t.*\t/' >> /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate.txt
#
if [ -s /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate.txt ]; then
	while IFS= read line; do grep -nr -m 1 --perl-regex '$line' /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg | cut -d':' -f1 >> /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate_line.txt; done< /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate.txt
	while IFS= read line; do sed '$lined' /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg.tmp; done< /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate_line.txt
fi
#
LC_COLLATE=C sort -k1,1 -k2,2n /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg.tmp > /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg
bedGraphToBigWig /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg /fdb/atac_dnase_pipelines/mm10/mm10.chrom.sizes /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bigwig
#
if [ -f /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bigwig ]; then
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_peaks.broadPeak
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_summits.bed
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_treat_pileup.bdg
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_control_lambda.bdg
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_FE.bdg
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.tmp
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.gz.sorted
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broadPeak.bdg.tmp
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate.txt
	rm -rf /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.broad.duplicate_line.txt
fi
#
EXECUTING....
#
INFO  @ Fri, 24 May 2019 18:04:10: 
# Command line: callpeak --treatment /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/post_alignment/AB3835-L1.processed.bed.gz --name AB3835-L1.macs2_broad --format BED --gsize mm --broad --broad-cutoff 5.00e-02 --keep-dup all -q 5.00e-02 -B --SPMR --nomodel --shift -75 --extsize 300 --verbose 3 --outdir /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak
# ARGUMENTS LIST:
# name = AB3835-L1.macs2_broad
# format = BED
# ChIP-seq file = ['/data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/post_alignment/AB3835-L1.processed.bed.gz']
# control file = None
# effective genome size = 1.87e+09
# band width = 300
# model fold = [5, 50]
# qvalue cutoff for narrow/strong regions = 5.00e-02
# qvalue cutoff for broad/weak regions = 5.00e-02
# The maximum gap between significant sites is assigned as the read length/tag size.
# The minimum length of peaks is assigned as the predicted fragment length "d".
# Larger dataset will be scaled towards smaller dataset.
# Range for calculating regional lambda is: 10000 bps
# Broad region calling is on
# Paired-End mode is off
# MACS will save fragment pileup signal per million reads
 
INFO  @ Fri, 24 May 2019 18:04:10: #1 read tag files... 
INFO  @ Fri, 24 May 2019 18:04:10: #1 read treatment tags... 
INFO  @ Fri, 24 May 2019 18:04:13:  1000000 
INFO  @ Fri, 24 May 2019 18:04:15:  2000000 
INFO  @ Fri, 24 May 2019 18:04:18:  3000000 
INFO  @ Fri, 24 May 2019 18:04:20:  4000000 
INFO  @ Fri, 24 May 2019 18:04:22:  5000000 
INFO  @ Fri, 24 May 2019 18:04:25:  6000000 
INFO  @ Fri, 24 May 2019 18:04:27:  7000000 
INFO  @ Fri, 24 May 2019 18:04:29:  8000000 
INFO  @ Fri, 24 May 2019 18:04:32:  9000000 
INFO  @ Fri, 24 May 2019 18:04:34:  10000000 
INFO  @ Fri, 24 May 2019 18:04:36:  11000000 
INFO  @ Fri, 24 May 2019 18:04:39:  12000000 
INFO  @ Fri, 24 May 2019 18:04:41:  13000000 
INFO  @ Fri, 24 May 2019 18:04:43:  14000000 
INFO  @ Fri, 24 May 2019 18:04:46:  15000000 
INFO  @ Fri, 24 May 2019 18:04:48:  16000000 
INFO  @ Fri, 24 May 2019 18:04:50:  17000000 
INFO  @ Fri, 24 May 2019 18:04:53:  18000000 
INFO  @ Fri, 24 May 2019 18:04:55:  19000000 
INFO  @ Fri, 24 May 2019 18:04:57:  20000000 
INFO  @ Fri, 24 May 2019 18:05:00:  21000000 
INFO  @ Fri, 24 May 2019 18:05:02:  22000000 
INFO  @ Fri, 24 May 2019 18:05:04:  23000000 
INFO  @ Fri, 24 May 2019 18:05:07:  24000000 
INFO  @ Fri, 24 May 2019 18:05:09:  25000000 
INFO  @ Fri, 24 May 2019 18:05:11:  26000000 
INFO  @ Fri, 24 May 2019 18:05:14:  27000000 
INFO  @ Fri, 24 May 2019 18:05:16:  28000000 
INFO  @ Fri, 24 May 2019 18:05:18:  29000000 
INFO  @ Fri, 24 May 2019 18:05:21:  30000000 
INFO  @ Fri, 24 May 2019 18:05:23:  31000000 
INFO  @ Fri, 24 May 2019 18:05:25:  32000000 
INFO  @ Fri, 24 May 2019 18:05:28:  33000000 
INFO  @ Fri, 24 May 2019 18:05:30:  34000000 
INFO  @ Fri, 24 May 2019 18:05:32:  35000000 
INFO  @ Fri, 24 May 2019 18:05:35:  36000000 
INFO  @ Fri, 24 May 2019 18:05:37:  37000000 
INFO  @ Fri, 24 May 2019 18:05:39:  38000000 
INFO  @ Fri, 24 May 2019 18:05:42:  39000000 
INFO  @ Fri, 24 May 2019 18:05:44:  40000000 
INFO  @ Fri, 24 May 2019 18:05:46:  41000000 
INFO  @ Fri, 24 May 2019 18:05:49:  42000000 
INFO  @ Fri, 24 May 2019 18:05:51:  43000000 
INFO  @ Fri, 24 May 2019 18:05:53:  44000000 
INFO  @ Fri, 24 May 2019 18:05:56:  45000000 
INFO  @ Fri, 24 May 2019 18:05:58:  46000000 
INFO  @ Fri, 24 May 2019 18:06:00:  47000000 
INFO  @ Fri, 24 May 2019 18:06:03:  48000000 
INFO  @ Fri, 24 May 2019 18:06:05: #1 tag size is determined as 70 bps 
INFO  @ Fri, 24 May 2019 18:06:05: #1 tag size = 70.0 
INFO  @ Fri, 24 May 2019 18:06:05: #1  total tags in treatment: 48621023 
INFO  @ Fri, 24 May 2019 18:06:05: #1 finished! 
INFO  @ Fri, 24 May 2019 18:06:05: #2 Build Peak Model... 
INFO  @ Fri, 24 May 2019 18:06:05: #2 Skipped... 
INFO  @ Fri, 24 May 2019 18:06:05: #2 Use 300 as fragment length 
INFO  @ Fri, 24 May 2019 18:06:05: #2 Sequencing ends will be shifted towards 5' by 75 bp(s) 
INFO  @ Fri, 24 May 2019 18:06:05: #3 Call peaks... 
INFO  @ Fri, 24 May 2019 18:06:05: #3 Call broad peaks with given level1 -log10qvalue cutoff and level2: 1.301030, 1.301030... 
INFO  @ Fri, 24 May 2019 18:06:05: #3 Pre-compute pvalue-qvalue table... 
DEBUG @ Fri, 24 May 2019 18:06:05: Start to calculate pvalue stat... 
DEBUG @ Fri, 24 May 2019 18:10:03: access pq hash for 134760172 times 
INFO  @ Fri, 24 May 2019 18:10:03: #3 In the peak calling step, the following will be performed simultaneously: 
INFO  @ Fri, 24 May 2019 18:10:03: #3   Write bedGraph files for treatment pileup (after scaling if necessary)... AB3835-L1.macs2_broad_treat_pileup.bdg 
INFO  @ Fri, 24 May 2019 18:10:03: #3   Write bedGraph files for control lambda (after scaling if necessary)... AB3835-L1.macs2_broad_control_lambda.bdg 
INFO  @ Fri, 24 May 2019 18:10:03: #3 Call peaks for each chromosome... 
INFO  @ Fri, 24 May 2019 18:17:21: #4 Write output xls file... /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_peaks.xls 
INFO  @ Fri, 24 May 2019 18:17:22: #4 Write broad peak in broadPeak format file... /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_peaks.broadPeak 
INFO  @ Fri, 24 May 2019 18:17:22: #4 Write broad peak in bed12/gappedPeak format file... /data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_peaks.gappedPeak 
INFO  @ Fri, 24 May 2019 18:17:23: Done! 
pass1 - making usageList (22 chroms): 46 millis
pass2 - checking and writing primary data (100991 records, 9 fields): 512 millis
INFO  @ Fri, 24 May 2019 18:17:27: Read and build treatment bedGraph... 
INFO  @ Fri, 24 May 2019 18:19:03: Read and build control bedGraph... 
INFO  @ Fri, 24 May 2019 18:19:43: Build scoreTrackII... 
INFO  @ Fri, 24 May 2019 18:20:17: Calculate scores comparing treatment and control by 'FE'... 
INFO  @ Fri, 24 May 2019 18:28:05: Write bedGraph of scores... 
INFO  @ Fri, 24 May 2019 18:31:15: Finished 'FE'! Please check '/data/shamsaddinisha/jfarber-20160119-P1/spsingh-20190308-E1/spsingh-20190521-D1/mm10/Ccl20+_T/peak_calling/broadpeak/AB3835-L1.macs2_broad_FE.bdg'! 
#
DONE!!!!
#
ELAPSED TIME: 4593 seconds
------------------------------------------------------------------------------
[Fri May 24 19:20:43 2019]
Finished job 0.
1 of 1 steps (100%) done
